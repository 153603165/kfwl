<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8"/>
</head>
<body>
<div th:replace="include/include::html"></div>
<iframe id="download_temp_iframe" style="display: none;"></iframe>

    <div data-options="region:'north',title:'报表导出',collapsed:false,split:false,border:false"
    style="padding: 0px; height: auto; width: 100%; overflow-y: hidden;">
        <form id="billingRecordExport_search_form" style="padding: 2px;">
			日期：
            <input id="startTime" style="width: 150px" name="startTime" class="easyui-my97" data-options="dateFmt:'yyyy/MM'"/>
            	-
            <input id="endTime" style="width: 150px" name="endTime" class="easyui-my97" data-options="dateFmt:'yyyy/MM'"/>
			注册人:
            <input class="easyui-textbox" type="text" name="regName" id="regName" style="width: 100px" />
			所属公司:
            <input class="easyui-textbox" type="text" name="companyName" id="companyName" style="width: 200px" />
			总含税金额大于：
			<input name="totalTaxAmount" type="text" class="easyui-numberbox" id="totalTaxAmount" style="width: 100px" 
	                   		maxLength="50" data-options="precision:2"/>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onClick="loadData();">查询</a>
            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onClick="downloadFile();">导出</a>
			<a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-clear'" onClick="billingRecordExport_clear();">清空</a>
        </form>
    </div>
    <!-- 中间部分 列表 -->	
    <div data-options="region:'center'" style="padding: 0px; height: 570px; width: 100%; overflow-y: hidden;">
	    <table id="billingRecordExport_datagrid"  style="width: auto;">
	    </table>
    </div>
</body>
<script type="text/JavaScript" th:inline="javascript">
/*<![CDATA[*/
    var billingRecordExport_search_form;
    $(document).ready(function(){
        billingRecordExport_search_form = $('#billingRecordExport_search_form').form();
    });
    function loadData(){
    	var startTime=$("#startTime").val();
		var endTime=$("#endTime").val();
		var totalTaxAmount=$("#totalTaxAmount").textbox('getValue');
		var companyName=$("#companyName").textbox('getValue');
		var regName=$("#regName").textbox('getValue');
		if(startTime==''||endTime==''){
			eu.showMsg("请完整填写年月");
			return false;
		}
		if(startTime>endTime){
			eu.showMsg("月份开始时间不能超过结束时间");
			return false;
		}
		$.getJSON('/billingRecord/billingRecordExportTitle',
				{"startTime":startTime,"endTime":endTime,"totalTaxAmount":totalTaxAmount,"companyName":companyName,"regName":regName},function(data){
			writeTable(data,startTime,endTime,totalTaxAmount,companyName,regName);
		});  
    }
        //数据列表
    function writeTable(data,startTime,endTime,totalTaxAmount,companyName,regName){
       	$('#billingRecordExport_datagrid').datagrid({
            url: '/billingRecord/exportBillingRecordDatagrId',
            queryParams: {          
                'startTime': startTime,
                'endTime': endTime,
                'totalTaxAmount': totalTaxAmount,
                'companyName': companyName,
                'regName': regName,
            },  
            fit:true,
            method:'get',
            pagination: false,//底部分页
            pagePosition: 'bottom',//'top','bottom','both'.
            fitColumns: false,//自适应列宽
            striped: true,//显示条纹
            //pageSize: 20,//每页记录数
            singleSelect: false,//单选模式
            rownumbers: true,//显示行数
            checkbox: true,
            nowrap: false,
            border: false,
            remoteSort: true,//是否通过远程服务器对数据排序
            sortName: 'id',//默认排序字段
            sortOrder: 'asc',//默认排序方式 'desc' 'asc'
            idField: 'id',
            frozenColumns:[data.thsfix],
            columns: [data.ths],
            onLoadSuccess:function(data){
		    	$(this).datagrid('clearSelections');//取消所有的已选择项
		    	$(this).datagrid('unselectAll');//取消全选按钮为全选状态
			},
            onRowContextMenu: function (e, rowIndex, rowData) {
                e.preventDefault();
                $(this).datagrid('unselectAll');
                $(this).datagrid('selectRow', rowIndex);
            },onLoadError: function(xhr,textStatus,errorThrown){
				var result=JSON.parse(xhr.responseText);
			    eu.showMsg(result.message);
    		},	
        }).datagrid("showTooltip");
     	// 表头居中
        eu.datagridHeaderCenter();
	}
  //弹出加载层
    function load() {  
        $("<div class=\"datagrid-mask\"></div>").css({ display: "block", width: "100%", height: $(window).height() }).appendTo("body");  
        $("<div class=\"datagrid-mask-msg\"></div>").html("正在上传，请稍候。。。").appendTo("body").css({ display: "block", left: ($(document.body).outerWidth(true) - 190) / 2, top: ($(window).height() - 45) / 2 });  
    }  
      
    //取消加载层  
    function disLoad() {  
        $(".datagrid-mask").remove();  
        $(".datagrid-mask-msg").remove();  
    }
  	// 清空
  	function billingRecordExport_clear() {
  		billingRecordExport_search_form.form("clear");
  	}
  	//下载
	function downloadFile() {
		var startTime=$("#startTime").val();
		var endTime=$("#endTime").val();
		var totalTaxAmount=$("#totalTaxAmount").val();
		var companyName=$("#companyName").val();
		var regName=$("#regName").val();
		if(startTime==''||endTime==''){
			eu.showMsg("请完整填写年月");
			return false;
		}
		if(startTime>endTime){
			eu.showMsg("月份开始时间不能超过结束时间");
			return false;
		}
		$('#download_temp_iframe').attr('src','/billingRecord/exportBillingRecordExcel?startTime='+startTime+'&endTime='+endTime+'&companyName='+encodeURI(encodeURI(companyName))+'&regName='+encodeURI(encodeURI(regName))+'&totalTaxAmount='+totalTaxAmount);
	}		
	/*]]>*/
</script>
</html>